{% macro answerOrName(name, url) %}
  {% if url %}
    <a class="link font-theme--code" href="{{ url }}">{{ name }}</a>
  {% else %}
    <span class="font-theme--code">{{ name }}</span>
  {% endif %}
{% endmacro %}

{% macro roleLabel(role) %}
  {% set roleUrl = allRoles[role].url %}
  {% if role.url %}
    {% set roleUrl = role.url %}
  {% endif %}
  {% set roleTitle = allRoles[role].title %}
  {% if role.title %}
    {% set roleTitle = role.title %}
  {% endif %}
  {% set roleColor = allRoles[role].color %}
  {% if role.color %}
    {% set roleColor = role.color %}
  {% endif %}
  {% set roleBackground = allRoles[role].bgColor %}
  {% if role.bgColor %}
    {% set roleBackground = role.bgColor %}
  {% endif %}
  {% set roleHover = allRoles[role].hoverColor %}
  {% if role.hoverColor %}
    {% set roleHover = role.hoverColor %}
  {% endif %}
  {% set roleBorder = allRoles[role].border %}
  {% if role.border %}
    {% set roleBorder = role.border %}
  {% endif %}
  <a href="{{ roleUrl }}" class="answer__author-roles-link" style="--role-color: {{ roleColor }}; --role-bg-color: {{ roleBackground }}; --role-hover-color: {{ roleHover }}; --role-border-color: {{ roleBorder }}">
    {{ roleTitle }}
  </a>
{% endmacro %}

{% if questions.length > 0 %}
  <section class="questions" id="questions">
    {{ questionsAuthors.length }}
    <h2 class="questions__title">
      На собеседовании
    </h2>

    <p class="questions__description">
      Это партёрская рубрика, мы выпускаем её совместно с сервисом онлайн-образования <a href="https://practicum.yandex.ru/catalog/programming/" title="Каталог курсов по программированию от Яндекс Практикума">Яндекс Практикум</a>. Приносите вопрос, на который не знаете ответа, в <a href="https://github.com/doka-guide/content/issues?q=is%3Aopen+is%3Aissue+label%3Aсобеседование" title="Все ишью для контента Доки, отфильтрованные по лейблу «собеседование»">issue</a>, мы разложим всё по полочкам и опубликуем. Если знаете ответ, присылайте <a href="https://github.com/doka-guide/content/blob/main/docs/contributing.md" title="Общая инструкция по написанию новых материалов для Доки">pull request на GitHub</a>.
    </p>

    {% for question in questions %}
      <div class="question__request">
        {{ question.templateContent | safe }}
      </div>

      <div class="question__response">
        {% for answer in answers %}
          {% set answerAuthor = collections.peopleById[answer.fileSlug] %}

          <article class="question__answer answer" id="question-{{ question.fileSlug }}-answer-{{ answer.fileSlug }}">
            <h3 class="answer__author">
              <span class="answer__author-roles">
                {% for roleKey in answerAuthor.data.roles %}
                  {{ roleLabel(
                    role=roleKey
                  ) }}
                {% endfor %}
              </span>
              <span class="answer__author-name">
                {{ answerOrName(
                  name=(answerAuthor.data.name or answer.fileSlug),
                  url='/people/' + answerAuthor.fileSlug + '/'
                ) }}
              </span>
              отвечает
            </h3>
            <div class="answer__content {% if not answer.isLong %}answer__content--short{% endif %} content">
              <div class="answer__summary content">
                {{ answer.templateContent | safe }}
                {% if answer.isLong %}
                  <button class="answer__toggler" type="button" aria-live="polite" data-collapsed>
                    + Развернуть
                  </button>
                {% endif %}
              </div>
            </div>
          </article>
        {% endfor %}
      </div>
    {% endfor %}

  </section>
{% endif %}
